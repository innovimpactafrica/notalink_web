<app-main-layout [pageTitle]="'Rendez-vous'">
    <div class="w-full mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold text-gray-900">Rendez-vous</h1>
            <button (click)="openNewRendezVousModal()"
                class="inline-flex items-center px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Nouveau rendez-vous
            </button>
        </div>

        <!-- Filters -->
        <div class="bg-white shadow-sm p-4 rounded-t-lg">
            <div class="flex items-center justify-between space-x-4">
                <div class="flex items-center space-x-2 w-full">
                    <div class="relative w-1/4">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                        <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()"
                            placeholder="Rechercher un rendez-vous..."
                            class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4B068] focus:border-transparent">
                    </div>
                    <div class="relative flex items-center space-x-1">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg width="14" height="10" viewBox="0 0 14 10" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M0.75 0.833008H13.25M2.83333 4.99967H11.1667M5.33333 9.16634H8.66667"
                                    stroke="#777777" stroke-width="1.25" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                        </div>
                        <select [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()"
                            class="pl-7 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#D4B068] focus:border-transparent appearance-none bg-white">
                            <option value="">Statut</option>
                            <option value="planifie">Planifié</option>
                            <option value="confirme">Confirmé</option>
                            <option value="annule">Annulé</option>
                            <option value="termine">Terminé</option>
                        </select>
                    </div>
                    <button (click)="clearFilters()"
                        class="flex items-center gap-2 px-4 py-3 w-28 border border-gray-200 bg-white rounded-lg hover:bg-gray-50 transition-colors">
                        <svg width="14" height="10" viewBox="0 0 14 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M0.75 0.833008H13.25M2.83333 4.99967H11.1667M5.33333 9.16634H8.66667"
                                stroke="#777777" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        Filter
                    </button>
                </div>
                <div class="flex items-center">
                    <button
                        [class]="currentView === 'list' ? 'bg-[#D4B036] bg-opacity-10 text-yellow-800' : 'bg-white text-gray-600'"
                        (click)="switchView('list')" class="p-2 rounded-md hover:bg-gray-50">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M7.5013 16.6663H16.668C17.1263 16.6663 17.5188 16.5033 17.8455 16.1772C18.1721 15.8511 18.3352 15.4586 18.3346 14.9997V13.333H7.5013V16.6663ZM1.66797 6.66634H5.83464V3.33301H3.33464C2.8763 3.33301 2.48408 3.49634 2.15797 3.82301C1.83186 4.14967 1.66852 4.5419 1.66797 4.99967V6.66634ZM1.66797 11.6663H5.83464V8.33301H1.66797V11.6663ZM3.33464 16.6663H5.83464V13.333H1.66797V14.9997C1.66797 15.458 1.8313 15.8505 2.15797 16.1772C2.48464 16.5038 2.87686 16.6669 3.33464 16.6663ZM7.5013 11.6663H18.3346V8.33301H7.5013V11.6663ZM7.5013 6.66634H18.3346V4.99967C18.3346 4.54134 18.1716 4.14912 17.8455 3.82301C17.5194 3.4969 17.1269 3.33356 16.668 3.33301H7.5013V6.66634Z"
                                fill="#777777" />
                        </svg>
                    </button>
                    <button
                        [class]="currentView === 'calendar' ? 'bg-[#D4B036]  bg-opacity-10 text-yellow-800' : 'bg-white text-gray-600'"
                        (click)="switchView('calendar')" class="p-2 rounded-md hover:bg-gray-50">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6.66602 1.66699V5.00033" stroke="#D4B036" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path d="M13.334 1.66699V5.00033" stroke="#D4B036" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                            <path
                                d="M15.8333 3.33301H4.16667C3.24619 3.33301 2.5 4.0792 2.5 4.99967V16.6663C2.5 17.5868 3.24619 18.333 4.16667 18.333H15.8333C16.7538 18.333 17.5 17.5868 17.5 16.6663V4.99967C17.5 4.0792 16.7538 3.33301 15.8333 3.33301Z"
                                stroke="#D4B036" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            <path d="M2.5 8.33301H17.5" stroke="#D4B036" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Calendar View -->
        <div *ngIf="currentView === 'calendar'" class="bg-white shadow-sm  rounded-b-lg">
            <!-- Calendar Header -->
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center space-x-2">
                    <button (click)="previousMonth()" class="p-2 text-[#4F55FB] hover:bg-gray-100 rounded-md">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7">
                            </path>
                        </svg>
                    </button>
                    <h2 class="text-xl font-semibold text-[#003861]">{{getCurrentMonthYear()}}</h2>
                    <button (click)="nextMonth()" class="p-2 text-[#4F55FB] hover:bg-gray-100 rounded-md">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7">
                            </path>
                        </svg>
                    </button>
                </div>

                <div class="flex items-center">
                    <button [class]="calendarView === 'day' ? 'bg-[#D4B036] text-white' : 'bg-white text-[#003861]'"
                        (click)="calendarView = 'day'"
                        class="px-3 py-1 text-sm font-semibold rounded-md hover:bg-gray-50">
                        Jour
                    </button>
                    <button [class]="calendarView === 'week' ? 'bg-[#D4B036] text-white' : 'bg-white text-[#003861]'"
                        (click)="calendarView = 'week'"
                        class="px-3 py-1 text-sm font-semibold rounded-md hover:bg-gray-50">
                        Semaine
                    </button>
                    <button [class]="calendarView === 'month' ? 'bg-[#D4B036] text-white' : 'bg-white text-[#003861]'"
                        (click)="calendarView = 'month'"
                        class="px-3 py-1 text-sm font-semibold rounded-md hover:bg-gray-50">
                        Mois
                    </button>
                </div>
            </div>

            <!-- Calendar Grid -->
            <div class="p-4">
                <!-- Days of week header -->
                <div class="grid grid-cols-7">
                    <div *ngFor="let day of daysOfWeek"
                        class="p-2 text-center text-sm font-medium text-gray-500 border border-gray-200 uppercase">
                        {{day}}
                    </div>
                </div>

                <!-- Calendar days -->
                <div class="grid grid-cols-7">
                    <div *ngFor="let day of calendarDays" class="min-h-[120px] p-2 border border-gray-200"
                        [class.bg-gray-50]="!day.isCurrentMonth" [class.bg-blue-100]="day.isToday && day.isCurrentMonth"
                        [class.border-blue-300]="day.isToday && day.isCurrentMonth">

                        <div class="flex items-center justify-between">
                            <span
                                class="text-sm font-medium  mb-2 rounded-full w-6 h-6 rounded-full flex items-center justify-center"
                                [class.text-gray-400]="!day.isCurrentMonth"
                                [class.text-white]="day.isToday && day.isCurrentMonth"
                                [class.bg-blue-600]="day.isToday && day.isCurrentMonth"
                                [class.text-gray-900]="day.isCurrentMonth && !day.isToday">
                                {{day.date.getDate()}}
                            </span>
                        </div>

                        <!-- Events for this day -->
                        <div class="space-y-1">
                            <div *ngFor="let rdv of getRendezVousForDay(day.date)" (click)="openDetailsModal(rdv)"
                                class="px-2 py-1 text-xs rounded cursor-pointer truncate" [class]="getEventClass(rdv)">
                                <div class="font-medium">{{rdv.heure}}</div>
                                <div class="truncate font-semibold text-md">{{rdv.motif}}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- List View -->
        <div *ngIf="currentView === 'list'" class="bg-white rounded-lg shadow-sm border border-gray-200">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date & Heure</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Motif</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Client</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Statut</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr *ngFor="let rdv of filteredRendezVous" class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">{{getFormattedDate(rdv.date)}}</div>
                                <div class="text-sm text-gray-500">{{rdv.heure}} ({{rdv.duree}}min)</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900 font-medium">{{rdv.motif}}</div>
                                <div *ngIf="rdv.dossierNumero" class="text-sm text-gray-500">{{rdv.dossierNumero}}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                {{rdv.clientName}}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span [class]="getTypeClass(rdv.type)">{{getTypeLabel(rdv.type)}}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span [class]="getStatusClass(rdv.statut)">{{getStatusLabel(rdv.statut)}}</span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button (click)="openDetailsModal(rdv)" class="text-blue-600 hover:text-blue-900 mr-4">
                                    Voir
                                </button>
                                <button (click)="editRendezVous(rdv)" class="text-yellow-600 hover:text-yellow-900">
                                    Modifier
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredRendezVous.length === 0"
            class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">Aucun rendez-vous</h3>
            <p class="mt-1 text-sm text-gray-500">Commencez par créer un nouveau rendez-vous.</p>
            <div class="mt-6">
                <button (click)="openNewRendezVousModal()"
                    class="inline-flex items-center px-4 py-2 bg-yellow-600 text-white text-sm font-medium rounded-md hover:bg-yellow-700">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Nouveau rendez-vous
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <app-new-rendezvous-modal [isOpen]="showNewModal" (close)="closeNewModal()" (save)="createRendezVous($event)">
    </app-new-rendezvous-modal>

    <app-rendezvous-details-modal [isOpen]="showDetailsModal" [rendezVous]="selectedRendezVous"
        (close)="closeDetailsModal()" (modify)="editRendezVous($event)" (cancel)="cancelRendezVous($event)">
    </app-rendezvous-details-modal>
</app-main-layout>